


- 扩展(Extension)
- 节点(Node)
- 标记(Mark)
- 插件(Plugin)
- 模式(Schema)
- 状态(State)


## 架构

### WriteFlow 编辑器

- 创建扩展管理器(ExtensionManager)
- 创建编辑器视图(EditorView)
  - 创建编辑器状态(EditorState)

### 扩展(Extension)

> 扩展是 WriteFlow 的核心概念, 用于扩展编辑器功能

ExtensionManager 扩展管理器
- 从扩展中创建模式(Schema)
  - 收集所有节点(Node)
  - 收集所有标记(Mark)
- 从扩展中创建插件(Plugin)
  - 收集所有输入规则(InputRule)
  - 收集所有快捷键(Keymap)


```ts
// 扩展, 创建节点
import { Node } from '@/components/WriteFlow/core/Node';
export const Heading = Node.create<HeadingOptions>({
  // 扩展名称, 用于往 schema 中注册节点, 会根据 this.name 注册成对应的节点(heading)
  name: 'heading', 

  // 扩展的配置项, 会存储在 extension 对象中
  options: {
    HTMLAttributes: {},
    levels: [1, 2, 3, 4, 5, 6],
  },

  // 返回一个节点配置对象(NodeSpec), 用于往 schema 中注册节点
  getSchema() {
    return {
      content: 'inline*',
      group: 'block',
      defining: true,

      // 注意: toDOM 要想接收 attrs 属性, 需要先在这定义 attrs 属性, 才能正确传递获取到该属性值
      attrs: {
        level: { default: 1 },
      },

      // 决定了如果渲染节点, 比如: 渲染 heading 节点时, 会渲染成 <h1> 标签
      // 用于往 schema 中注册节点, 会根据 this.name 注册成对应的节点
      toDOM: (node) => {
        const { level } = node.attrs;
        return [`h${level}`, {}, 0];
      },
    };
  },

  // 返回一个输入规则(InputRule)的数组, 会添加到 plugins 中, 用于创建输入规则(inputRules)
  addInputRules({ type }) {
    return [
      textblockTypeInputRule(new RegExp('^(#{1,6})\\s$'), type, (match) => ({
        level: match[1].length,
      })),
    ];
  },
});

```